language: node_js
node_js:
- '8'
branches:
  only:
  - master
dist: trusty
services:
- mongodb
- redis-server
env:
- NODE_ENV=ci PORT=3000
cache:
  directories:
  - node_modules
  - client/node_modules
install:
- npm install
- npm run build
script:
- nohup npm run start &
- sleep 5
- npm run test
deploy:
  provider: heroku
  app:
    master: advanced-node
    production: advanced-node
  api_key:
    secure: "1db8312d-215e-4ba4-acdd-1b3985c60e69"
